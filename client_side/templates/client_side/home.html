{% load static %}
<!-- new -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://js.stripe.com/v3/"></script>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- <title>Django + Stripe Subscriptions</title> -->
    <!-- <script src="https://js.stripe.com/v3/"></script> -->
    <!-- <script src="{% static 'main.js' %}"></script> -->
    <!-- new -->
    <script
      src="https://code.jquery.com/jquery-3.5.1.min.js"
      integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
      integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z"
      crossorigin="anonymous"
    />
    <script
      src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"
      integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV"
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <!-- <div class="container mt-5">
      <button type="submit" class="btn btn-primary" id="submitBtn">Subscribe</button>
    </div> -->
    <body>
      <button id="checkout">Subscribe</button>
    </body>

    <!-- <script src="https://js.stripe.com/v3/"></script>  -->
    <script>
      // If a fetch error occurs, log it to the console and show it in the UI.
      var handleFetchResult = function(result) {
        if (!result.ok) {
          return result.json().then(function(json) {
            if (json.error && json.error.message) {
              throw new Error(result.url + ' ' + result.status + ' ' + json.error.message);
            }
          }).catch(function(err) {
            showErrorMessage(err);
            throw err;
          });
        }
        return result.json();
      };

      // Create a Checkout Session with the selected plan ID
      var createCheckoutSession = function (priceId) {
        return fetch("create-checkout-session/", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({
            priceId: priceId,
          }),
        }).then(function (result) {
          return result.json();
        });
      };

      // Handle any errors returned from Checkout
      var handleResult = function(result) {
        if (result.error) {
          showErrorMessage(result.error.message);
        }
      };

      var showErrorMessage = function(message) {
        var errorEl = document.getElementById("error-message")
        errorEl.textContent = message;
        errorEl.style.display = "block";
      };

      /* Get your Stripe publishable key to initialize Stripe.js */
      // fetch("/setup")
      //   .then(handleFetchResult)
      //   .then(function(json) {
      var publishableKey = 'pk_test_51IMRaLKZBodb43Wyt0YQANBSHnkgMcTPPVIWjwOL1P24D4Y2tu3jbY3mefF6Y3DDXpkvLce0H47DTsFg5cO8LRtS0068JTVE1K';
          // var basicPriceId = json.basicPrice;
      var PriceId = 'prod_IyluVlc8MmHOIX';
        
        var stripe = Stripe(publishableKey);
        // Setup event handler to create a Checkout Session when button is clicked
        document.getElementById("checkout")
        .addEventListener("click", function (evt) {
          alert('text');
          // var PriceId = 'prod_IyluVlc8MmHOIX';
          createCheckoutSession(PriceId).then(function (data) {
            // Call Stripe.js method to redirect to the new Checkout page
            alert('text');
            stripe.redirectToCheckout({
                sessionId: data.sessionId,
              })
              .then(handleResult);
          });
        });
    </script>
  </body>
</html>
